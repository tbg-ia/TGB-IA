{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-5 bg-dark">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card bg-dark border-light">
                <div class="card-header bg-transparent border-light">
                    <h4 class="text-white mb-0">Cambio de Plan</h4>
                </div>
                <div class="card-body">
                    <!-- Planes actuales y nuevo -->
                    <div class="d-flex justify-content-center align-items-center gap-4 mb-4">
                        <div class="text-center">
                            <h5 class="text-white">{{ current_plan.name }}</h5>
                            <p class="text-muted">({{ current_plan.get_remaining_days() }} días)</p>
                        </div>
                        <div class="text-muted">
                            <i class="bi bi-arrow-right fs-4"></i>
                        </div>
                        <div class="text-center">
                            <h5 class="text-white">{{ new_plan.name }}</h5>
                            <p class="text-muted">({{ new_plan.trial_days + 30 }} días)</p>
                        </div>
                    </div>

                    <!-- Precio -->
                    <div class="text-center mb-4">
                        <h5 class="text-white">Precio de la suscripción</h5>
                        <h3 class="text-primary">${{ "%.2f"|format(new_plan.price/100) }}</h3>
                    </div>

                    <!-- Advertencia -->
                    {% if not is_upgrade %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        Las limitaciones de la cuenta se aplicarán una vez que se realice el cambio. 
                        Esto significa que algunos bots y APIs podrían desactivarse, lo que podría llevar 
                        al cierre de posiciones. Por ejemplo, si un bot se desactiva debido a las 
                        limitaciones de la cuenta, cerrará las posiciones asociadas.
                    </div>
                    {% endif %}

                    <!-- Formulario de confirmación -->
                    <form action="{{ url_for('subscription.create_checkout_session') }}" method="POST" class="text-center">
                        <input type="hidden" name="plan_id" value="{{ new_plan.id }}">
                        <input type="hidden" name="confirm_plan_change" value="true">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="termsAccepted" required>
                            <label class="form-check-label text-light" for="termsAccepted">
                                Acepto los términos y condiciones del cambio de plan
                            </label>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg">
                            Confirmar Cambio
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
